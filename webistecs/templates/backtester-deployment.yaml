apiVersion: batch/v1
kind: Job
metadata:
  name: backtester-manual-run
  namespace: default
spec:
  template:
    metadata:
      labels:
        app: backtester-manual-run
    spec:
      restartPolicy: Never
      containers:
        - name: backtester
          image: emabhiza/webistecs-backtest:test-0.0.2
          imagePullPolicy: IfNotPresent
          env:
            - name: ASPNETCORE_ENVIRONMENT
              value: Development
            - name: BacktestParameters__Year
              value: "2022"
            - name: BacktestParameters__Month
              value: "1"
            - name: BacktestParameters__InitialUsdc
              value: "1000"
            - name: BacktestParameters__Strategy
              value: MacroUptrend
          volumeMounts:
            - name: pricedata-volume
              mountPath: /app/Resources
              readOnly: true
            - name: result-volume
              mountPath: /app/backtest-results
          resources:
            limits:
              cpu: "500m"
              memory: "512Mi"
            requests:
              cpu: "250m"
              memory: "256Mi"
      volumes:
        - name: pricedata-volume
          persistentVolumeClaim:
            claimName: pricedata-test-pvc
        - name: result-volume
          persistentVolumeClaim:
            claimName: backtest-results-pvc
